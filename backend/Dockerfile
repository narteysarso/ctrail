FROM node:12.16.1

WORKDIR /app

RUN npm install -g --unsafe-perm serverless

COPY ./package.json ./

RUN npm install 

COPY ./ ./

RUN sls config credentials --provider aws --key $AWS_ACCESS_KEY_ID --secret $AWS_SECRET_ACCESS_KEY --AWS_MONGO_USERNAME $AWS_MONGO_USERNAME --AWS_MONGO_PASSWORD $AWS_MONGO_PASSWORD --AWS_MONGO_HOSTNAME $AWS_MONGO_HOSTNAME --AWS_MONGO_PORT $AWS_MONGO_PORT --AWS_MONGO_DB $AWS_MONGO_DB --AWS_JWT_KEY $AWS_JWT_KEY --AWS_MAIL_HOST $AWS_MAIL_HOST --AWS_MAIL_USERNAME $AWS_MAIL_USERNAME --AWS_MAIL_PASSWORD $AWS_MAIL_PASSWORD

RUN sls deploy -v           