FROM node:12.16.1

WORKDIR /app

RUN npm install -g --unsafe-perm serverless

COPY ./package.json ./

RUN npm install 

COPY ./ ./

RUN sls config credentials --provider aws --key $AWS_ACCESS_KEY_ID --secret $AWS_SECRET_ACCESS_KEY

RUN sls deploy -v --MONGO_USERNAME $AWS_MONGO_USERNAME --MONGO_PASSWORD $AWS_MONGO_PASSWORD --MONGO_HOSTNAME $AWS_MONGO_HOSTNAME --MONGO_PORT $AWS_MONGO_PORT --MONGO_DB $AWS_MONGO_DB --JWT_KEY $AWS_JWT_KEY --MAIL_HOST $AWS_MAIL_HOST --MAIL_USERNAME $AWS_MAIL_USERNAME --MAIL_PASSWORD $AWS_MAIL_PASSWORD          